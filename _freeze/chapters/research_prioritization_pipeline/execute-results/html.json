{
  "hash": "c97c782717511c15b26b42c92185a4eb",
  "result": {
    "markdown": "# Research Prioritization Pipeline & Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"load packages & data\"}\nlibrary(tidyverse) \n\n# markdown et al. ----\nlibrary(knitr)\nlibrary(bookdown)\nlibrary(rmarkdown)\nlibrary(shiny)\nlibrary(quarto)\n\n# dataviz ----\nlibrary(ggrepel)\nlibrary(plotly) # Create Interactive Web Graphics via 'plotly.js'\nlibrary(RColorBrewer)  # for color palettes\n\n# others ----\nlibrary(here) # A Simpler Way to Find Your Files\n\n# Make sure select is always the dplyr version\nselect <- dplyr::select \n\n# options\noptions(knitr.duplicate.label = \"allow\")\noptions(mc.cores = parallel::detectCores())\n\n# data\nevals_pub <- readRDS(file = here(\"data\", \"evals.Rdata\"))\nall_papers_p <- readRDS(file = here(\"data\", \"all_papers_p.Rdata\"))\n\n# Lists of categories\nrating_cats <- c(\"overall\", \"adv_knowledge\", \"methods\", \"logic_comms\", \"real_world\", \"gp_relevance\", \"open_sci\")\n\n#... 'predictions' are currently 1-5 (0-5?)\npred_cats <- c(\"journal_predict\", \"merits_journal\")\n```\n:::\n\n\n    \n## Basic presentation\n\n### What sorts of papers/projects are we considering and evaluating? {-}\n\nIn this section, we give some simple data summaries and visualizations, for a broad description of The Unjournal's coverage. \n\n\n<!-- Todo: make this smaller, get it to fit on the page better, more user-friendly -->\n\n#### Initial pool of papers: categories {-}\n\nNext, we present a plot of categories for all papers in the Unjournal's initial pool. One paper can belong to more than one category. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# how many papers are in this dataset?\nn_papers <- select(all_papers_p, id) %>% distinct() %>% nrow()\n\n# plot\nall_papers_p %>% \n  select(id, category) %>% \n  unnest(category, keep_empty = T) %>%\n  distinct() %>% # just to make sure\n  replace_na(list(category = \"unknown\")) %>%\n  group_by(category) %>% \n  count() %>%\n  mutate(category = str_to_title(category)) %>%\n  ggplot(aes(x = reorder(category, n), y = n)) +\n  geom_bar(aes(fill = category), stat = \"identity\", color = \"grey30\") + \n  coord_flip() +\n  theme_bw() +\n  labs(y = \"Paper category\", x = \"Count\",\n       caption = paste0(\"Total number of papers = \", n_papers)) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](research_prioritization_pipeline_files/figure-html/all_paper_categories-1.png){width=672}\n:::\n:::\n\n\n\n::: {.callout-note collapse=\"true\"}\n##### Next consider...\n\n- Composition of research evaluated\n     - By field (economics, psychology, etc.)\n     - By subfield of economics \n     - By topic/cause area (Global health, economic development, impact of technology, global catastrophic risks, etc.    )\n     - By source (submitted, identified with author permission, direct evaluation)\n    \n- Timing of intake and evaluation^[Consider: timing might be its own section or chapter; this is a major thing journals track, and we want to keep track of ourselves]\n\n:::\n\n#### Paper selection {-}\n\nThe Sankey diagram below starts with the papers we prioritized for likely *Unjournal* evaluation:^[Those marked as 'considering' in the Airtable].\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Add in the 3 different evaluation input sources\n#update to be automated rather than hard-coded - to look at David's work here\n\npapers_considered <- all_papers_p %>% \n  nrow()\n\npapers_deprio <- all_papers_p %>% \n  filter(`stage of process/todo` ==  \"de-prioritized\") %>% \n  nrow()\n\npapers_evaluated <- all_papers_p %>% \n  filter(`stage of process/todo` %in% c(\"published\",\n                                        \"contacting/awaiting_authors_response_to_evaluation\",\n                                        \"awaiting_publication_ME_comments\",\"awaiting_evaluations\")) %>% \n  nrow()\n\npapers_complete <- all_papers_p %>% \n  filter(`stage of process/todo` ==  \"published\") %>%\n  nrow()\n\npapers_in_progress <-  papers_evaluated - papers_complete\n\npapers_still_in_consideration <-  all_papers_p %>% filter(`stage of process/todo` ==  \"considering\") %>% nrow()\n\n\n#todo: adjust wording of hover notes ('source, target...etc')\n\nfig <- plot_ly(\n  type = \"sankey\",\n  orientation = \"h\",\n  \n  node = list(\n    label = c(\"Prioritized\", \"Evaluating\", \"Complete\", \"In progress\", \"Still in consideration\", \"De-prioritized\"),\n    color = c(\"orange\", \"green\", \"green\", \"orange\", \"orange\", \"red\"),\n    #Todo: adjust 'location' to group these left to right\n    pad = 15,\n    thickness = 20,\n    line = list(\n      color = \"black\",\n      width = 0.5\n    )\n  ),\n  \n  link = list(\n    source = c(0,1,1,0,0),\n    target = c(1,2,3,4,5),\n    value =  c(\n      papers_evaluated,\n      papers_complete,\n      papers_in_progress,\n      papers_still_in_consideration,\n      papers_deprio\n    ))\n)\nfig <- fig %>% layout(\n  title = \"Unjournal paper funnel\",\n  font = list(\n    size = 10\n  )\n)\n\nfig \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nall_papers_p %>% \n  select(id, source_main, `stage of process/todo`) %>% \n  rename(stage = `stage of process/todo`) %>% \n  mutate(source_main = if_else(source_main == \"NA\", NA_character_, source_main)) %>% \n  replace_na(list(source_main = \"unknown\", stage = \"unknown\")) %>%\n  mutate(stage0 = \"Paper Pool\",\n         stage1 = case_match(stage,\n                             \"contacting/awaiting_authors_response_to_evaluation\" ~ \"Selected\",\n                             \"seeking_(more)_evaluators\" ~ \"Selected\",\n                             \"published\" ~ \"Selected\",\n                             .default = NA_character_),\n         stage2 = paste0(\"Stage: \", str_to_sentence(stage)),\n         source_main = str_replace_all(string = source_main, \n                                  pattern = \"-\", \n                                  replace = \" \") %>% \n           # str_to_title() %>% \n           str_replace_all(pattern = \"\\\\s+\",\n                       replacement = \" \"),\n         source = paste0(\"Source: \", source_main)) -> temp\n\ntemp %>% \n  select(source, stage0, stage1, stage2) %>%\n  pivot_longer(cols = everything()) %>% \n  arrange(name) %>% \n  select(value) %>% \n  distinct() %>% drop_na() -> nodes\n\n\nnodes = tibble(index =  seq(0,nrow(nodes)-1, by = 1),\n               label = nodes$value,\n               color = c(brewer.pal(n = length(unique(temp$source)), \"Pastel2\"), # Sources\n                         \"#984EA3\",# all papers\n                         \"#4DAF4A\",# selected\n                         \"#4DAF9A\",\"#FF7F00\",\"#FFFF33\", \"#A65628\", \"#999999\",\"#377288\", \"#F781BF\",\"#999999\")) #outcomes\n\n\n# link = tibble(source = c(),\n#               target = c(),\n#               value = c())\n\n# source -> paper pool (stage0) -> stage1 -> stage2\n\n# add source > paper pool (stage0)\nlink = temp %>% \n  group_by(source, stage0) %>% \n  count() %>%\n  rename(target = stage0, value = n) \n\n# add paper pool > stage1 (selected)\ntemp %>% \n  group_by(stage0, stage1) %>% \n  count() %>%\n  rename(source = stage0, target = stage1, value = n) %>% \n  filter(!is.na(target)) -> temp2\n\nlink = bind_rows(link, temp2)\n\n# add paper pool > stage2 (not selected)\ntemp %>% \n  group_by(stage0, stage1, stage2) %>% \n  count() %>% \n  ungroup() %>%\n  filter(is.na(stage1)) %>%\n  rename(source = stage0, target = stage2, value = n) %>%\n  select(-stage1) -> temp2\n\nlink = bind_rows(link, temp2) \n\n# add selected (stage1) to stage 2\ntemp %>% \n  group_by(stage0, stage1, stage2) %>% \n  count() %>% \n  ungroup() %>% \n  filter(stage1 == \"Selected\") %>% \n  rename(source = stage1, target = stage2, value = n) %>%\n  select(-stage0) -> temp2\n\nlink = bind_rows(link, temp2) \n\n# add node index to link\nlink %>% \n  ungroup() %>% \n  left_join(nodes, by = c(\"source\" = \"label\")) %>%\n  rename(source_index = index) %>% \n  left_join(nodes, by = c(\"target\" = \"label\")) %>%\n  rename(target_index = index) %>% \n  select(source_index, target_index, value) %>%\n  rename(source = source_index,\n         target = target_index) -> link\n\n\n\nfig <- plot_ly(type = \"sankey\", orientation = \"h\", \n\n  node = list(\n    label = nodes$label,\n    color = nodes$color,\n    pad = 15,\n    thickness = 20,\n    line = list(color = \"black\", width = 0.5),\n    hovertemplate = \"%{label}: %{value:.0f} papers<extra></extra>\"\n    ),\n  \n  link = list(\n    source = link$source,\n    target = link$target,\n    value =  as.integer(link$value),\n    hovertemplate = \"%{value:.0f} papers<extra></extra>\"\n  ))\n\nfig <- fig %>% layout(\n  title = \"Unjournal Paper Flow Diagram\",\n  font = list(size = 10)\n)\n\nfig\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"plotly html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-8812a28414e2a6bb8ed3\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-8812a28414e2a6bb8ed3\">{\"x\":{\"visdat\":{\"fc62148832c0\":[\"function () \",\"plotlyVisDat\"]},\"cur_data\":\"fc62148832c0\",\"attrs\":{\"fc62148832c0\":{\"orientation\":\"h\",\"node\":{\"label\":[\"Source: internal from syllabus agenda policy database\",\"Source: submitted\",\"Source: suggested externally\",\"Source: internal NBER\",\"Source: unknown\",\"Source: suggested internally\",\"Source: suggested externally NGO\",\"Paper Pool\",\"Selected\",\"Stage: Published\",\"Stage: Unknown\",\"Stage: Considering\",\"Stage: Non-academic stream possibility\",\"Stage: De-prioritized\",\"Stage: Seeking_(more)_evaluators\",\"Stage: Contacting/awaiting_authors_response_to_evaluation\",\"Stage: Not a paper/project\"],\"color\":[\"#B3E2CD\",\"#FDCDAC\",\"#CBD5E8\",\"#F4CAE4\",\"#E6F5C9\",\"#FFF2AE\",\"#F1E2CC\",\"#984EA3\",\"#4DAF4A\",\"#4DAF9A\",\"#FF7F00\",\"#FFFF33\",\"#A65628\",\"#999999\",\"#377288\",\"#F781BF\",\"#999999\"],\"pad\":15,\"thickness\":20,\"line\":{\"color\":\"black\",\"width\":0.5},\"hovertemplate\":\"%{label}: %{value:.0f} papers<extra><\\/extra>\"},\"link\":{\"source\":[3,0,1,2,6,5,4,7,7,7,7,7,7,8,8,8],\"target\":[7,7,7,7,7,7,7,8,11,13,12,16,10,15,9,14],\"value\":[53,8,9,13,14,16,21,15,22,1,3,1,92,1,10,4],\"hovertemplate\":\"%{value:.0f} papers<extra><\\/extra>\"},\"alpha_stroke\":1,\"sizes\":[10,100],\"spans\":[1,20],\"type\":\"sankey\"}},\"layout\":{\"margin\":{\"b\":40,\"l\":60,\"t\":25,\"r\":10},\"title\":\"Unjournal Paper Flow Diagram\",\"font\":{\"size\":10},\"hovermode\":\"closest\",\"showlegend\":false},\"source\":\"A\",\"config\":{\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"data\":[{\"orientation\":\"h\",\"node\":{\"label\":[\"Source: internal from syllabus agenda policy database\",\"Source: submitted\",\"Source: suggested externally\",\"Source: internal NBER\",\"Source: unknown\",\"Source: suggested internally\",\"Source: suggested externally NGO\",\"Paper Pool\",\"Selected\",\"Stage: Published\",\"Stage: Unknown\",\"Stage: Considering\",\"Stage: Non-academic stream possibility\",\"Stage: De-prioritized\",\"Stage: Seeking_(more)_evaluators\",\"Stage: Contacting/awaiting_authors_response_to_evaluation\",\"Stage: Not a paper/project\"],\"color\":[\"#B3E2CD\",\"#FDCDAC\",\"#CBD5E8\",\"#F4CAE4\",\"#E6F5C9\",\"#FFF2AE\",\"#F1E2CC\",\"#984EA3\",\"#4DAF4A\",\"#4DAF9A\",\"#FF7F00\",\"#FFFF33\",\"#A65628\",\"#999999\",\"#377288\",\"#F781BF\",\"#999999\"],\"pad\":15,\"thickness\":20,\"line\":{\"color\":\"black\",\"width\":0.5},\"hovertemplate\":\"%{label}: %{value:.0f} papers<extra><\\/extra>\"},\"link\":{\"source\":[3,0,1,2,6,5,4,7,7,7,7,7,7,8,8,8],\"target\":[7,7,7,7,7,7,7,8,11,13,12,16,10,15,9,14],\"value\":[53,8,9,13,14,16,21,15,22,1,3,1,92,1,10,4],\"hovertemplate\":\"%{value:.0f} papers<extra><\\/extra>\"},\"type\":\"sankey\",\"frame\":null}],\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n",
    "supporting": [
      "research_prioritization_pipeline_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/htmlwidgets-1.6.2/htmlwidgets.js\"></script>\n<script src=\"../site_libs/plotly-binding-4.10.2/plotly.js\"></script>\n<script src=\"../site_libs/typedarray-0.1/typedarray.min.js\"></script>\n<script src=\"../site_libs/jquery-3.5.1/jquery.min.js\"></script>\n<link href=\"../site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\n<link href=\"../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/plotly-main-2.11.1/plotly-latest.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}