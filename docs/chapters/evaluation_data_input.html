<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>The Unjournal evaluations: data and analysis - 1&nbsp; Evaluation data: input/features</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/evaluation_data_analysis.html" rel="next">
<link href="../index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/evaluation_data_input.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Evaluation data: input/features</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">The Unjournal evaluations: data and analysis</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/daaronr/unjournaldata/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/evaluation_data_input.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Evaluation data: input/features</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/evaluation_data_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Evaluation data: description, exploration, checks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/aggregation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Aggregation of evaluators judgments (modeling)</span></span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#reconcile-uncertainty-ratings-and-cis" id="toc-reconcile-uncertainty-ratings-and-cis" class="nav-link active" data-scroll-target="#reconcile-uncertainty-ratings-and-cis">Reconcile uncertainty ratings and CIs</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/daaronr/unjournaldata/edit/main/chapters/evaluation_data_input.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/daaronr/unjournaldata/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Evaluation data: input/features</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="cell">
<details><summary>load packages</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># data acquisition ----</span></span>
<span><span class="co">#devtools::install_github("bergant/airtabler")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bergant/airtabler">airtabler</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># data cleaning &amp; shaping ----</span></span>
<span></span>
<span><span class="co"># data analysis ----</span></span>
<span><span class="co"># library(lme4)</span></span>
<span><span class="co"># library(lmtest) # Testing Linear Regression Models</span></span>
<span></span>
<span><span class="co"># markdown et al. ----</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/bookdown">bookdown</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/quarto-dev/quarto-r">quarto</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://renkun-ken.github.io/formattable/">formattable</a></span><span class="op">)</span> <span class="co"># Create 'Formattable' Data Structures</span></span>
<span></span>
<span><span class="co"># others ----</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span> <span class="co"># A Simpler Way to Find Your Files</span></span>
<span><span class="co">#devtools::install_github("metamelb-repliCATS/aggreCAT")</span></span>
<span><span class="co">#library(aggrecat)</span></span>
<span></span>
<span><span class="co"># Make sure select is always the dplyr version</span></span>
<span><span class="va">select</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="va"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> </span>
<span></span>
<span><span class="co"># options</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>knitr.duplicate.label <span class="op">=</span> <span class="st">"allow"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note on data input (10-Aug-23)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Below, the evaluation data is input from an Airtable, which itself was largely hand-input from evaluators’ reports. As PubPub builds (target: end of Sept.&nbsp;2023), this will allow us to include the ratings and predictions as structured data objects. We then plan to access and input this data <em>directly</em> from the PubPub (API?) into the present analysis. This will improve automation and limit the potential for data entry errors.</p>
</div>
</div>
</div>
<div class="cell">
<details><summary>input from airtable</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">base_id</span> <span class="op">&lt;-</span> <span class="st">"appbPYEw9nURln7Qg"</span></span>
<span></span>
<span></span>
<span><span class="co"># Set your Airtable API key </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span>AIRTABLE_API_KEY <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"AIRTABLE_API_KEY"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#this should be set in my .Renviron file</span></span>
<span></span>
<span><span class="co"># Read data from a specific view</span></span>
<span></span>
<span><span class="va">evals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/airtabler/man/air_get.html">air_get</a></span><span class="op">(</span>base <span class="op">=</span> <span class="va">base_id</span>, <span class="st">"output_eval"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">all_pub_records</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pub_records</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/airtabler/man/air_select.html">air_select</a></span><span class="op">(</span>base <span class="op">=</span> <span class="va">base_id</span>, table <span class="op">=</span> <span class="st">"crucial_research"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Append the records to the list</span></span>
<span><span class="va">all_pub_records</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">all_pub_records</span>, <span class="va">pub_records</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># While the length of the records list is 100 (the maximum), fetch more records</span></span>
<span><span class="kw">while</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pub_records</span><span class="op">)</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Get the ID of the last record in the list</span></span>
<span>  <span class="va">offset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/airtabler/man/get_offset.html">get_offset</a></span><span class="op">(</span><span class="va">pub_records</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Fetch the next 100 records, starting after the last ID</span></span>
<span>  <span class="va">pub_records</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/airtabler/man/air_select.html">air_select</a></span><span class="op">(</span>base <span class="op">=</span> <span class="va">base_id</span>, table <span class="op">=</span> <span class="st">"crucial_research"</span>, offset <span class="op">=</span>  <span class="va">offset</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Append the records to the df</span></span>
<span>  <span class="va">all_pub_records</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">all_pub_records</span>, <span class="va">pub_records</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># housekeeping</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">pub_records</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>just the useful and publish-able data, clean a bit</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># clean evals names to snakecase</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">evals</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">snakecase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/snakecase/man/caseconverter.html">to_snake_case</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">evals</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">evals_pub</span> <span class="op">&lt;-</span> <span class="va">evals</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>stage_of_process <span class="op">=</span> <span class="va">stage_of_process_todo_from_crucial_research_2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>stage_of_process <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">stage_of_process</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">stage_of_process</span> <span class="op">==</span> <span class="st">"published"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, </span>
<span>           <span class="va">crucial_research</span>, </span>
<span>           <span class="va">paper_abbrev</span>, </span>
<span>           <span class="va">evaluator_name</span>, </span>
<span>           <span class="va">category</span>, </span>
<span>           <span class="va">source_main</span>, </span>
<span>           <span class="va">author_agreement</span>, </span>
<span>           <span class="va">overall</span>, </span>
<span>           <span class="va">lb_overall</span>, </span>
<span>           <span class="va">ub_overall</span>, </span>
<span>           <span class="va">conf_index_overall</span>, </span>
<span>           <span class="va">advancing_knowledge_and_practice</span>, </span>
<span>           <span class="va">lb_advancing_knowledge_and_practice</span>, </span>
<span>           <span class="va">ub_advancing_knowledge_and_practice</span>, </span>
<span>           <span class="va">conf_index_advancing_knowledge_and_practice</span>,</span>
<span>           <span class="va">methods_justification_reasonableness_validity_robustness</span>,</span>
<span>           <span class="va">lb_methods_justification_reasonableness_validity_robustness</span>,</span>
<span>           <span class="va">ub_methods_justification_reasonableness_validity_robustness</span>,</span>
<span>           <span class="va">conf_index_methods_justification_reasonableness_validity_robustness</span>, </span>
<span>           <span class="va">logic_communication</span>, <span class="va">lb_logic_communication</span>, <span class="va">ub_logic_communication</span>, </span>
<span>           <span class="va">conf_index_logic_communication</span>,</span>
<span>           <span class="va">engaging_with_real_world_impact_quantification_practice_realism_and_relevance</span>,</span>
<span>           <span class="va">lb_engaging_with_real_world_impact_quantification_practice_realism_and_relevance</span>,</span>
<span>           <span class="va">ub_engaging_with_real_world_impact_quantification_practice_realism_and_relevance</span>,</span>
<span>           <span class="va">conf_index_engaging_with_real_world_impact_quantification_practice_realism_and_relevance</span>,</span>
<span>           <span class="va">relevance_to_global_priorities</span>, </span>
<span>           <span class="va">lb_relevance_to_global_priorities</span>, </span>
<span>           <span class="va">ub_relevance_to_global_priorities</span>, </span>
<span>           <span class="va">conf_index_relevance_to_global_priorities</span>, </span>
<span>           <span class="va">journal_quality_predict</span>, </span>
<span>           <span class="va">lb_journal_quality_predict</span>, </span>
<span>           <span class="va">ub_journal_quality_predict</span>,</span>
<span>           <span class="va">conf_index_journal_quality_predict</span>, </span>
<span>           <span class="va">open_collaborative_replicable</span>, </span>
<span>           <span class="va">conf_index_open_collaborative_replicable</span>, </span>
<span>           <span class="va">lb_open_collaborative_replicable</span>, </span>
<span>           <span class="va">ub_open_collaborative_replicable</span>, </span>
<span>           <span class="va">merits_journal</span>, </span>
<span>           <span class="va">lb_merits_journal</span>, </span>
<span>           <span class="va">ub_merits_journal</span>, </span>
<span>           <span class="va">conf_index_merits_journal</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># shorten names (before you expand into columns)</span></span>
<span><span class="va">new_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"eval_name"</span> <span class="op">=</span> <span class="st">"evaluator_name"</span>,</span>
<span>  <span class="st">"cat"</span> <span class="op">=</span> <span class="st">"category"</span>,</span>
<span>  <span class="st">"crucial_rsx"</span> <span class="op">=</span> <span class="st">"crucial_research"</span>,</span>
<span>  <span class="st">"conf_overall"</span> <span class="op">=</span> <span class="st">"conf_index_overall"</span>,</span>
<span>  <span class="st">"adv_knowledge"</span> <span class="op">=</span> <span class="st">"advancing_knowledge_and_practice"</span>,</span>
<span>  <span class="st">"lb_adv_knowledge"</span> <span class="op">=</span> <span class="st">"lb_advancing_knowledge_and_practice"</span>,</span>
<span>  <span class="st">"ub_adv_knowledge"</span> <span class="op">=</span> <span class="st">"ub_advancing_knowledge_and_practice"</span>,</span>
<span>  <span class="st">"conf_adv_knowledge"</span> <span class="op">=</span> <span class="st">"conf_index_advancing_knowledge_and_practice"</span>,</span>
<span>  <span class="st">"methods"</span> <span class="op">=</span> <span class="st">"methods_justification_reasonableness_validity_robustness"</span>,</span>
<span>  <span class="st">"lb_methods"</span> <span class="op">=</span> <span class="st">"lb_methods_justification_reasonableness_validity_robustness"</span>,</span>
<span>  <span class="st">"ub_methods"</span> <span class="op">=</span> <span class="st">"ub_methods_justification_reasonableness_validity_robustness"</span>,</span>
<span>  <span class="st">"conf_methods"</span> <span class="op">=</span> <span class="st">"conf_index_methods_justification_reasonableness_validity_robustness"</span>,</span>
<span>  <span class="st">"logic_comms"</span> <span class="op">=</span> <span class="st">"logic_communication"</span>,</span>
<span>  <span class="st">"lb_logic_comms"</span> <span class="op">=</span> <span class="st">"lb_logic_communication"</span>,</span>
<span>  <span class="st">"ub_logic_comms"</span> <span class="op">=</span> <span class="st">"ub_logic_communication"</span>,</span>
<span>  <span class="st">"conf_logic_comms"</span> <span class="op">=</span> <span class="st">"conf_index_logic_communication"</span>,</span>
<span>  <span class="st">"real_world"</span> <span class="op">=</span> <span class="st">"engaging_with_real_world_impact_quantification_practice_realism_and_relevance"</span>,</span>
<span>  <span class="st">"lb_real_world"</span> <span class="op">=</span> <span class="st">"lb_engaging_with_real_world_impact_quantification_practice_realism_and_relevance"</span>,</span>
<span>  <span class="st">"ub_real_world"</span> <span class="op">=</span> <span class="st">"ub_engaging_with_real_world_impact_quantification_practice_realism_and_relevance"</span>,</span>
<span>  <span class="st">"conf_real_world"</span> <span class="op">=</span> <span class="st">"conf_index_engaging_with_real_world_impact_quantification_practice_realism_and_relevance"</span>,</span>
<span>  <span class="st">"gp_relevance"</span> <span class="op">=</span> <span class="st">"relevance_to_global_priorities"</span>,</span>
<span>  <span class="st">"lb_gp_relevance"</span> <span class="op">=</span> <span class="st">"lb_relevance_to_global_priorities"</span>,</span>
<span>  <span class="st">"ub_gp_relevance"</span> <span class="op">=</span> <span class="st">"ub_relevance_to_global_priorities"</span>,</span>
<span>  <span class="st">"conf_gp_relevance"</span> <span class="op">=</span> <span class="st">"conf_index_relevance_to_global_priorities"</span>,</span>
<span>  <span class="st">"journal_predict"</span> <span class="op">=</span> <span class="st">"journal_quality_predict"</span>,</span>
<span>  <span class="st">"lb_journal_predict"</span> <span class="op">=</span> <span class="st">"lb_journal_quality_predict"</span>,</span>
<span>  <span class="st">"ub_journal_predict"</span> <span class="op">=</span> <span class="st">"ub_journal_quality_predict"</span>,</span>
<span>  <span class="st">"conf_journal_predict"</span> <span class="op">=</span> <span class="st">"conf_index_journal_quality_predict"</span>,</span>
<span>  <span class="st">"open_sci"</span> <span class="op">=</span> <span class="st">"open_collaborative_replicable"</span>,</span>
<span>  <span class="st">"conf_open_sci"</span> <span class="op">=</span> <span class="st">"conf_index_open_collaborative_replicable"</span>,</span>
<span>  <span class="st">"lb_open_sci"</span> <span class="op">=</span> <span class="st">"lb_open_collaborative_replicable"</span>,</span>
<span>  <span class="st">"ub_open_sci"</span> <span class="op">=</span> <span class="st">"ub_open_collaborative_replicable"</span>,</span>
<span>  <span class="st">"conf_merits_journal"</span> <span class="op">=</span> <span class="st">"conf_index_merits_journal"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">evals_pub</span> <span class="op">&lt;-</span> <span class="va">evals_pub</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">new_names</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#  Create a list of labels with the old, longer names</span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="va">new_names</span>, <span class="st">"_"</span>, <span class="st">" "</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assign labels to the dataframe / tibble</span></span>
<span><span class="co"># (maybe this can be done as an attribute, not currently working)</span></span>
<span><span class="co"># for(i in seq_along(labels)) {</span></span>
<span><span class="co">#    col_name &lt;- new_names[names(new_names)[i]]</span></span>
<span><span class="co">#    label &lt;- labels[i]</span></span>
<span><span class="co">#    attr(evals_pub[[col_name]], "label") &lt;- label</span></span>
<span><span class="co">#  }</span></span>
<span></span>
<span></span>
<span><span class="co"># expand categories into columns, unlist everything</span></span>
<span><span class="va">evals_pub</span> <span class="op">%&lt;&gt;%</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_wider.html">unnest_wider</a></span><span class="op">(</span><span class="va">cat</span>, names_sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># give each of these its own col</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">unlist</span><span class="op">)</span><span class="op">)</span>  <span class="co"># maybe check why some of these are lists in the first place</span></span>
<span>  </span>
<span></span>
<span><span class="co"># clean the Anonymous names</span></span>
<span><span class="va">evals_pub</span><span class="op">$</span><span class="va">eval_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"^\\b\\w+\\b$|\\bAnonymous\\b"</span>, <span class="va">evals_pub</span><span class="op">$</span><span class="va">eval_name</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Anonymous_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">evals_pub</span><span class="op">$</span><span class="va">eval_name</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">evals_pub</span><span class="op">$</span><span class="va">eval_name</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#housekeeping</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">evals</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Todo -- check the unlist is not propagating the entry</span></span>
<span><span class="co">#Note: category,  topic_subfield, and source have multiple meaningful categories. These will need care  </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>

<!-- need airtable API stuff -->
<section id="reconcile-uncertainty-ratings-and-cis" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="reconcile-uncertainty-ratings-and-cis">Reconcile uncertainty ratings and CIs</h3>
<p>Where people gave only confidence level ‘dots’, we impute CIs (confidence/credible intervals). We follow the correspondence described <a href="https://effective-giving-marketing.gitbook.io/unjournal-x-ea-and-global-priorities-research/policies-projects-evaluation-workflow/evaluation/guidelines-for-evaluators#1-5-dots-explanation-and-relation-to-cis">here</a>. (Otherwise, where they gave actual CIs, we use these.)<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dots to interval choices
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<blockquote class="blockquote">
<p>5 = Extremely confident, i.e., 90% confidence interval spans +/- 4 points or less)</p>
</blockquote>
<p>For 0-100 ratings, code the LB as <span class="math inline">\(max(R - 4,0)\)</span> and the UB as <span class="math inline">\(min(R + 4,100)\)</span>, where R is the stated (middle) rating. This ‘scales’ the CI, as interpreted, to be proportional to the rating, with a maximum ‘interval’ of about 8, with the rating is about 96.</p>
<blockquote class="blockquote">
<p>4 = Very*confident: 90% confidence interval +/- 8 points or less</p>
</blockquote>
<p>For 0-100 ratings, code the LB as <span class="math inline">\(max(R - 8,0)\)</span> and the UB as <span class="math inline">\(min(R + 8,100)\)</span>, where R is the stated (middle) rating.</p>
<blockquote class="blockquote">
<p>3 = Somewhat** confident: 90% confidence interval +/- 15 points or less </p>
</blockquote>
<blockquote class="blockquote">
<p>2 = Not very** confident: 90% confidence interval, +/- 25 points or less</p>
</blockquote>
<p>Comparable scaling for the 2-3 ratings as for the 4 and 5 rating.</p>
<blockquote class="blockquote">
<p>1 = Not** confident: (90% confidence interval +/- more than 25 points)</p>
</blockquote>
<p>Code LB as <span class="math inline">\(max(R - 37.5,0)\)</span> and the UB as <span class="math inline">\(min(R + 37.5,100)\)</span>.</p>
<p>This is just a first-pass. There might be a more information-theoretic way of doing this. On the other hand, we might be switching the evaluations to use a different tool soon, perhaps getting rid of the 1-5 confidence ratings altogether.</p>
</div>
</div>
</div>
<div class="cell">
<details><summary>reconcile explicit bounds and stated confidence level</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Define the baseline widths for each confidence rating</span></span>
<span><span class="co"># JB: it would be good to have some more backing of whether this</span></span>
<span><span class="co"># is a valid way to translate these confidence levels into CIs</span></span>
<span></span>
<span><span class="co"># baseline_widths &lt;- c(4, 8, 15, 25, 37.5)</span></span>
<span></span>
<span><span class="co"># Lists of categories</span></span>
<span><span class="va">rating_cats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"overall"</span>, <span class="st">"adv_knowledge"</span>, <span class="st">"methods"</span>, <span class="st">"logic_comms"</span>, <span class="st">"real_world"</span>, <span class="st">"gp_relevance"</span>, <span class="st">"open_sci"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#... 'predictions' are currently 1-5 (0-5?)</span></span>
<span><span class="va">pred_cats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"journal_predict"</span>, <span class="st">"merits_journal"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#DR: Note that I use these objects in future chapters, but they are not connected to the data frame. Either one saves and reinputs the whole environment (messy, replicability issue), or you save this somewhere and re-input it or connect it to the data frame that gets saved (not sure how to do it), or you hard-code reinput it in the next chapter. </span></span>
<span></span>
<span><span class="co">#I do the latter for now, but I'm not happy about it, because the idea is 'input definitions in a single place to use later'</span></span>
<span></span>
<span><span class="co">#JB: I don't really understand why not just hard code it in the next chapter. These are very short strings. Do you expect them to change often? If so, we can derive them from a dataframe somewhere in the future or save as a separate object. </span></span>
<span></span>
<span></span>
<span><span class="co"># JB: Rewritten functions for adding imputed ub and lb</span></span>
<span></span>
<span><span class="co"># calculate the lower and upper bounds, </span></span>
<span><span class="co"># rating: given a rating, </span></span>
<span><span class="co"># conf: a confidence (1-5) score,</span></span>
<span><span class="co"># type: a bound type (lower, upper),</span></span>
<span><span class="co"># scale: a scale (100 is 0-100, 5 is 1-5)</span></span>
<span><span class="co"># This function is not vectorized</span></span>
<span><span class="va">calc_bounds</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rating</span>, <span class="va">conf</span>, <span class="va">type</span>, <span class="va">scale</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">scale</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span><span class="op">{</span> <span class="co">#for the 'journal tier prediction case'</span></span>
<span>    <span class="va">baseline_width</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html">case_match</a></span><span class="op">(</span><span class="va">conf</span>, </span>
<span>                                <span class="fl">5</span> <span class="op">~</span> <span class="fl">.2</span>, <span class="co">#4*5/100</span></span>
<span>                                <span class="fl">4</span> <span class="op">~</span> <span class="fl">.4</span>, <span class="co">#8*5/100</span></span>
<span>                                <span class="fl">3</span> <span class="op">~</span> <span class="fl">.75</span>, <span class="co">#15*5/100</span></span>
<span>                                <span class="fl">2</span> <span class="op">~</span> <span class="fl">1.25</span>, <span class="co">#25*5/100</span></span>
<span>                                <span class="fl">1</span> <span class="op">~</span> <span class="fl">1.875</span>, <span class="co">#37.5*5/100</span></span>
<span>                                .default <span class="op">=</span> <span class="cn">NA_real_</span><span class="op">)</span> </span>
<span></span>
<span>    <span class="va">upper</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">+</span> <span class="va">baseline_width</span>, <span class="fl">5</span><span class="op">)</span></span>
<span>    <span class="va">lower</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">-</span> <span class="va">baseline_width</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="co">#/if(scale == 5)</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">scale</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span><span class="op">{</span> <span class="co">#for the 'ratings case'</span></span>
<span>    </span>
<span>    <span class="va">baseline_width</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html">case_match</a></span><span class="op">(</span><span class="va">conf</span>, </span>
<span>                                <span class="fl">5</span> <span class="op">~</span> <span class="fl">4</span>, </span>
<span>                                <span class="fl">4</span> <span class="op">~</span> <span class="fl">8</span>, </span>
<span>                                <span class="fl">3</span> <span class="op">~</span> <span class="fl">15</span>, </span>
<span>                                <span class="fl">2</span> <span class="op">~</span> <span class="fl">25</span>, </span>
<span>                                <span class="fl">1</span> <span class="op">~</span> <span class="fl">37.5</span>,</span>
<span>                                .default <span class="op">=</span> <span class="cn">NA_real_</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">upper</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">+</span> <span class="va">baseline_width</span>, <span class="fl">100</span><span class="op">)</span></span>
<span>    <span class="va">lower</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">rating</span> <span class="op">-</span> <span class="va">baseline_width</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="co">#/if(scale == 100)</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"lower"</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"upper"</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">upper</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># calculate or find correct lower or upper bound</span></span>
<span><span class="co"># based on rating type, and lb, ub, and conf values</span></span>
<span><span class="va">impute_bounds</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">var_name</span>, <span class="va">est</span>, <span class="va">lb</span>, <span class="va">ub</span>, <span class="va">conf</span>, <span class="va">bound_type</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># get scale of each variable</span></span>
<span>  <span class="va">scale</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">var_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"journal_predict"</span>, <span class="st">"merits_journal"</span><span class="op">)</span>, <span class="co"># if variable is a prediction</span></span>
<span>                  <span class="fl">5</span>, <span class="fl">100</span><span class="op">)</span> <span class="co">#scale is 5, else scale is 100</span></span>
<span>  <span class="co"># if calculating lower bound variable</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">bound_type</span> <span class="op">==</span> <span class="st">"lower"</span><span class="op">)</span> <span class="op">{</span> <span class="co">#we are calculating a lower bound imputation</span></span>
<span>    <span class="co"># </span></span>
<span>    <span class="va">calculated_bound</span> <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">est</span>, .f <span class="op">=</span> <span class="va">calc_bounds</span>, conf <span class="op">=</span> <span class="va">conf</span>, type <span class="op">=</span> <span class="va">bound_type</span>, scale <span class="op">=</span> <span class="va">scale</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">imp_bound</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">lb</span><span class="op">)</span>, <span class="va">calculated_bound</span>, <span class="va">lb</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># if calculating upper bound variable</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">bound_type</span> <span class="op">==</span> <span class="st">"upper"</span><span class="op">)</span> <span class="op">{</span> <span class="co">#we are calculating an upper bound imputation</span></span>
<span>    <span class="co"># </span></span>
<span>    <span class="va">calculated_bound</span> <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">est</span>, .f <span class="op">=</span> <span class="va">calc_bounds</span>, conf <span class="op">=</span> <span class="va">conf</span>, type <span class="op">=</span> <span class="va">bound_type</span>, scale <span class="op">=</span> <span class="va">scale</span><span class="op">)</span></span>
<span>    <span class="va">imp_bound</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ub</span><span class="op">)</span>, <span class="va">calculated_bound</span>, <span class="va">ub</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">imp_bound</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># apply functions to evals_pub</span></span>
<span><span class="co"># JB: I had to do a lot of gymnastics to make this data frame</span></span>
<span><span class="co"># right for applying the functions, then turn it back into</span></span>
<span><span class="co"># the data structure we are currently using I didn't want to deal</span></span>
<span><span class="co"># with how changing the data input would break the rest of the</span></span>
<span><span class="co"># code But we should prioritize saving this data frame in a long format</span></span>
<span><span class="co"># so there isn't data in the variable names (i.e., each row should at least </span></span>
<span><span class="co"># be one type of rating, not one article). </span></span>
<span></span>
<span><span class="va">evals_pub</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">crucial_rsx</span>, <span class="va">paper_abbrev</span>, <span class="va">eval_name</span>, </span>
<span>                         <span class="va">cat_1</span>,<span class="va">cat_2</span>, <span class="va">cat_3</span>,<span class="va">source_main</span>,<span class="va">author_agreement</span><span class="op">)</span>,</span>
<span>               names_pattern <span class="op">=</span> <span class="st">"(lb_|ub_|conf_)?(.+)"</span>,</span>
<span>               names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"value_type"</span>, <span class="st">"rating_type"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># one line per rating type</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>value_type <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">value_type</span> <span class="op">==</span> <span class="st">""</span>, <span class="st">"est_"</span>, <span class="va">value_type</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#add main rating id</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">value_type</span>, </span>
<span>              values_from <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># apply function to each row</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lb_imp_ <span class="op">=</span> <span class="fu">impute_bounds</span><span class="op">(</span>var_name <span class="op">=</span> <span class="va">rating_type</span>,</span>
<span>                                   est <span class="op">=</span> <span class="va">est_</span>,</span>
<span>                                   lb <span class="op">=</span> <span class="va">lb_</span>, ub <span class="op">=</span> <span class="va">ub_</span>, conf <span class="op">=</span> <span class="va">conf_</span>,</span>
<span>                                   bound_type <span class="op">=</span> <span class="st">"lower"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ub_imp_ <span class="op">=</span> <span class="fu">impute_bounds</span><span class="op">(</span>var_name <span class="op">=</span> <span class="va">rating_type</span>,</span>
<span>                                   est <span class="op">=</span> <span class="va">est_</span>,</span>
<span>                                   lb <span class="op">=</span> <span class="va">lb_</span>, ub <span class="op">=</span> <span class="va">ub_</span>, conf <span class="op">=</span> <span class="va">conf_</span>,</span>
<span>                                   bound_type <span class="op">=</span> <span class="st">"upper"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">rating_type</span>, <span class="co"># take the dataframe back to old format</span></span>
<span>              values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">est_</span>, <span class="va">ub_</span>, <span class="va">lb_</span>, <span class="va">conf_</span>, <span class="va">lb_imp_</span>, <span class="va">ub_imp_</span><span class="op">)</span>,</span>
<span>              names_sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"^[ul]b_imp"</span><span class="op">)</span>,</span>
<span>                     .fn <span class="op">=</span> <span class="va">gsub</span>,</span>
<span>                     pattern <span class="op">=</span> <span class="st">"(ub_imp|lb_imp)_(.+)"</span>, </span>
<span>                     replacement <span class="op">=</span> <span class="st">"\\2_\\1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"est_"</span><span class="op">)</span>,</span>
<span>                     .fn <span class="op">=</span> <span class="va">gsub</span>,</span>
<span>                     pattern <span class="op">=</span> <span class="st">"est_(.+)"</span>,</span>
<span>                     replacement <span class="op">=</span> <span class="st">"\\1"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">evals_pub</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We cannot publicly share the ‘papers under consideration’, but we can share some of the statistics on these papers. Let’s generate an ID (or later, salted hash) for each such paper, and keep only the shareable features of interest</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">all_papers_p</span> <span class="op">&lt;-</span> <span class="va">all_pub_records</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>    <span class="va">id</span>,</span>
<span>    <span class="va">category</span>,</span>
<span>    <span class="va">cfdc_DR</span>,</span>
<span>     <span class="st">'confidence -- user entered'</span>,</span>
<span>    <span class="va">cfdc_assessor</span>,</span>
<span>    <span class="va">avg_cfdc</span>,</span>
<span>    <span class="va">category</span>,</span>
<span>    <span class="va">cause_cat_1_text</span>,</span>
<span>    <span class="va">cause_cat_2_text</span>,</span>
<span>    <span class="va">topic_subfield_text</span>,</span>
<span>    <span class="va">eval_manager_text</span>,</span>
<span>    <span class="st">'publication status'</span>,</span>
<span>    <span class="st">'Contacted author?'</span>,</span>
<span>    <span class="st">'stage of process/todo'</span>,</span>
<span>    <span class="st">'source_main'</span>,  </span>
<span>    <span class="st">'author permission?'</span>,</span>
<span><span class="st">'Direct Kotahi Prize Submission?'</span>,</span>
<span>    <span class="st">'createdTime'</span>         </span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create a dataset to be used as the input to a shiny app</span></span>
<span></span>
<span><span class="co">#| include: false</span></span>
<span><span class="co">#| </span></span>
<span><span class="va">paper_ratings</span> <span class="op">&lt;-</span> <span class="va">evals_pub</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">paper_abbrev</span>, <span class="va">eval_name</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/one_of.html">one_of</a></span><span class="op">(</span><span class="va">rating_cats</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/one_of.html">one_of</a></span><span class="op">(</span><span class="va">pred_cats</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"_imp"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># rating vars</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename_with</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/one_of.html">one_of</a></span><span class="op">(</span><span class="va">rating_cats</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/one_of.html">one_of</a></span><span class="op">(</span><span class="va">pred_cats</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                     .fn <span class="op">=</span> <span class="va">gsub</span>,</span>
<span>                     pattern <span class="op">=</span> <span class="st">"(.+)"</span>, </span>
<span>                     replacement <span class="op">=</span> <span class="st">"\\1_best"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">paper_abbrev</span>, <span class="va">eval_name</span><span class="op">)</span>,</span>
<span>               names_pattern <span class="op">=</span> <span class="st">"(overall|adv_knowledge|methods|logic_comms|real_world|gp_relevance|open_sci|journal_predict|merits_journal)_(.+)"</span>,</span>
<span>               names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rating_type"</span>, <span class="st">".value"</span><span class="op">)</span><span class="op">)</span><span class="co"># one line per rating type</span></span>
<span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html">write_rds</a></span><span class="op">(</span><span class="va">paper_ratings</span>, file <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"shinyapp/DataExplorer"</span>, <span class="st">"shiny_explorer.rds"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>save data for others’ use</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">all_papers_p</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"all_papers_p.Rdata"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">all_papers_p</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"all_papers_p.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">evals_pub</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"evals.Rdata"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">evals_pub</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"evals.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#evals_pub %&gt;% readRDS(file = here("data", "evals.Rdata"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<!-- -->

</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Note this is only a first-pass; a more sophisticated approach may be warranted in future.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preface</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/evaluation_data_analysis.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Evaluation data: description, exploration, checks</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb8" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Evaluation data: input/features</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, warning=FALSE}</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-packages</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "load packages"</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># data acquisition ----</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#devtools::install_github("bergant/airtabler")</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(airtabler)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># data cleaning &amp; shaping ----</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># data analysis ----</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lme4)</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lmtest) # Testing Linear Regression Models</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># markdown et al. ----</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bookdown)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quarto)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(formattable) <span class="co"># Create 'Formattable' Data Structures</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># others ----</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here) <span class="co"># A Simpler Way to Find Your Files</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co">#devtools::install_github("metamelb-repliCATS/aggreCAT")</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co">#library(aggrecat)</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure select is always the dplyr version</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>select <span class="ot">&lt;-</span> dplyr<span class="sc">::</span>select </span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co"># options</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">knitr.duplicate.label =</span> <span class="st">"allow"</span>)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="fu">## Note on data input (10-Aug-23)</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>Below, the evaluation data is input from an Airtable, which itself was largely hand-input from evaluators' reports. As PubPub builds (target: end of Sept. 2023), this will allow us to  include the ratings and predictions as structured data objects. We then plan to access and input this data *directly* from the PubPub (API?) into the present analysis. This will improve automation and limit the potential for data entry errors.</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: input_at</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "input from airtable"</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>base_id <span class="ot">&lt;-</span> <span class="st">"appbPYEw9nURln7Qg"</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Set your Airtable API key </span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">AIRTABLE_API_KEY =</span> <span class="fu">Sys.getenv</span>(<span class="st">"AIRTABLE_API_KEY"</span>))</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="co">#this should be set in my .Renviron file</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Read data from a specific view</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>evals <span class="ot">&lt;-</span> <span class="fu">air_get</span>(<span class="at">base =</span> base_id, <span class="st">"output_eval"</span>) </span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>all_pub_records <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>pub_records <span class="ot">&lt;-</span> <span class="fu">air_select</span>(<span class="at">base =</span> base_id, <span class="at">table =</span> <span class="st">"crucial_research"</span>)</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Append the records to the list</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>all_pub_records <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_pub_records, pub_records)</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a><span class="co"># While the length of the records list is 100 (the maximum), fetch more records</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(<span class="fu">nrow</span>(pub_records) <span class="sc">==</span> <span class="dv">100</span>) {</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the ID of the last record in the list</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>  offset <span class="ot">&lt;-</span> <span class="fu">get_offset</span>(pub_records)</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fetch the next 100 records, starting after the last ID</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>  pub_records <span class="ot">&lt;-</span> <span class="fu">air_select</span>(<span class="at">base =</span> base_id, <span class="at">table =</span> <span class="st">"crucial_research"</span>, <span class="at">offset =</span>  offset)</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Append the records to the df</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>  all_pub_records <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_pub_records, pub_records)</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a><span class="co"># housekeeping</span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(pub_records)</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: extract &amp; clean</span></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "just the useful and publish-able data, clean a bit"</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a><span class="co"># clean evals names to snakecase</span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(evals) <span class="ot">&lt;-</span> snakecase<span class="sc">::</span><span class="fu">to_snake_case</span>(<span class="fu">colnames</span>(evals))</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>evals_pub <span class="ot">&lt;-</span> evals <span class="sc">%&gt;%</span> </span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">stage_of_process =</span> stage_of_process_todo_from_crucial_research_2) <span class="sc">%&gt;%</span> </span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage_of_process =</span> <span class="fu">unlist</span>(stage_of_process)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(stage_of_process <span class="sc">==</span> <span class="st">"published"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(id, </span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>           crucial_research, </span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>           paper_abbrev, </span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>           evaluator_name, </span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>           category, </span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>           source_main, </span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>           author_agreement, </span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>           overall, </span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>           lb_overall, </span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>           ub_overall, </span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>           conf_index_overall, </span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>           advancing_knowledge_and_practice, </span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>           lb_advancing_knowledge_and_practice, </span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>           ub_advancing_knowledge_and_practice, </span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>           conf_index_advancing_knowledge_and_practice,</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>           methods_justification_reasonableness_validity_robustness,</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>           lb_methods_justification_reasonableness_validity_robustness,</span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>           ub_methods_justification_reasonableness_validity_robustness,</span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>           conf_index_methods_justification_reasonableness_validity_robustness, </span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>           logic_communication, lb_logic_communication, ub_logic_communication, </span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>           conf_index_logic_communication,</span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>           engaging_with_real_world_impact_quantification_practice_realism_and_relevance,</span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>           lb_engaging_with_real_world_impact_quantification_practice_realism_and_relevance,</span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>           ub_engaging_with_real_world_impact_quantification_practice_realism_and_relevance,</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>           conf_index_engaging_with_real_world_impact_quantification_practice_realism_and_relevance,</span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>           relevance_to_global_priorities, </span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>           lb_relevance_to_global_priorities, </span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>           ub_relevance_to_global_priorities, </span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>           conf_index_relevance_to_global_priorities, </span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>           journal_quality_predict, </span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>           lb_journal_quality_predict, </span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>           ub_journal_quality_predict,</span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>           conf_index_journal_quality_predict, </span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a>           open_collaborative_replicable, </span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>           conf_index_open_collaborative_replicable, </span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>           lb_open_collaborative_replicable, </span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>           ub_open_collaborative_replicable, </span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>           merits_journal, </span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a>           lb_merits_journal, </span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>           ub_merits_journal, </span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a>           conf_index_merits_journal)</span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a><span class="co"># shorten names (before you expand into columns)</span></span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a>new_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a>  <span class="st">"eval_name"</span> <span class="ot">=</span> <span class="st">"evaluator_name"</span>,</span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cat"</span> <span class="ot">=</span> <span class="st">"category"</span>,</span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a>  <span class="st">"crucial_rsx"</span> <span class="ot">=</span> <span class="st">"crucial_research"</span>,</span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a>  <span class="st">"conf_overall"</span> <span class="ot">=</span> <span class="st">"conf_index_overall"</span>,</span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a>  <span class="st">"adv_knowledge"</span> <span class="ot">=</span> <span class="st">"advancing_knowledge_and_practice"</span>,</span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lb_adv_knowledge"</span> <span class="ot">=</span> <span class="st">"lb_advancing_knowledge_and_practice"</span>,</span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ub_adv_knowledge"</span> <span class="ot">=</span> <span class="st">"ub_advancing_knowledge_and_practice"</span>,</span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a>  <span class="st">"conf_adv_knowledge"</span> <span class="ot">=</span> <span class="st">"conf_index_advancing_knowledge_and_practice"</span>,</span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a>  <span class="st">"methods"</span> <span class="ot">=</span> <span class="st">"methods_justification_reasonableness_validity_robustness"</span>,</span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lb_methods"</span> <span class="ot">=</span> <span class="st">"lb_methods_justification_reasonableness_validity_robustness"</span>,</span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ub_methods"</span> <span class="ot">=</span> <span class="st">"ub_methods_justification_reasonableness_validity_robustness"</span>,</span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a>  <span class="st">"conf_methods"</span> <span class="ot">=</span> <span class="st">"conf_index_methods_justification_reasonableness_validity_robustness"</span>,</span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a>  <span class="st">"logic_comms"</span> <span class="ot">=</span> <span class="st">"logic_communication"</span>,</span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lb_logic_comms"</span> <span class="ot">=</span> <span class="st">"lb_logic_communication"</span>,</span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ub_logic_comms"</span> <span class="ot">=</span> <span class="st">"ub_logic_communication"</span>,</span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a>  <span class="st">"conf_logic_comms"</span> <span class="ot">=</span> <span class="st">"conf_index_logic_communication"</span>,</span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a>  <span class="st">"real_world"</span> <span class="ot">=</span> <span class="st">"engaging_with_real_world_impact_quantification_practice_realism_and_relevance"</span>,</span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lb_real_world"</span> <span class="ot">=</span> <span class="st">"lb_engaging_with_real_world_impact_quantification_practice_realism_and_relevance"</span>,</span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ub_real_world"</span> <span class="ot">=</span> <span class="st">"ub_engaging_with_real_world_impact_quantification_practice_realism_and_relevance"</span>,</span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a>  <span class="st">"conf_real_world"</span> <span class="ot">=</span> <span class="st">"conf_index_engaging_with_real_world_impact_quantification_practice_realism_and_relevance"</span>,</span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a>  <span class="st">"gp_relevance"</span> <span class="ot">=</span> <span class="st">"relevance_to_global_priorities"</span>,</span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lb_gp_relevance"</span> <span class="ot">=</span> <span class="st">"lb_relevance_to_global_priorities"</span>,</span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ub_gp_relevance"</span> <span class="ot">=</span> <span class="st">"ub_relevance_to_global_priorities"</span>,</span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a>  <span class="st">"conf_gp_relevance"</span> <span class="ot">=</span> <span class="st">"conf_index_relevance_to_global_priorities"</span>,</span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a>  <span class="st">"journal_predict"</span> <span class="ot">=</span> <span class="st">"journal_quality_predict"</span>,</span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lb_journal_predict"</span> <span class="ot">=</span> <span class="st">"lb_journal_quality_predict"</span>,</span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ub_journal_predict"</span> <span class="ot">=</span> <span class="st">"ub_journal_quality_predict"</span>,</span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a>  <span class="st">"conf_journal_predict"</span> <span class="ot">=</span> <span class="st">"conf_index_journal_quality_predict"</span>,</span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a>  <span class="st">"open_sci"</span> <span class="ot">=</span> <span class="st">"open_collaborative_replicable"</span>,</span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a>  <span class="st">"conf_open_sci"</span> <span class="ot">=</span> <span class="st">"conf_index_open_collaborative_replicable"</span>,</span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lb_open_sci"</span> <span class="ot">=</span> <span class="st">"lb_open_collaborative_replicable"</span>,</span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ub_open_sci"</span> <span class="ot">=</span> <span class="st">"ub_open_collaborative_replicable"</span>,</span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a>  <span class="st">"conf_merits_journal"</span> <span class="ot">=</span> <span class="st">"conf_index_merits_journal"</span></span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a>evals_pub <span class="ot">&lt;-</span> evals_pub <span class="sc">%&gt;%</span></span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="sc">!!!</span>new_names)</span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a><span class="co">#  Create a list of labels with the old, longer names</span></span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(new_names, <span class="st">"_"</span>, <span class="st">" "</span>) <span class="sc">%&gt;%</span> <span class="fu">str_to_title</span>()</span>
<span id="cb8-182"><a href="#cb8-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-183"><a href="#cb8-183" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign labels to the dataframe / tibble</span></span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true" tabindex="-1"></a><span class="co"># (maybe this can be done as an attribute, not currently working)</span></span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true" tabindex="-1"></a><span class="co"># for(i in seq_along(labels)) {</span></span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true" tabindex="-1"></a><span class="co">#    col_name &lt;- new_names[names(new_names)[i]]</span></span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a><span class="co">#    label &lt;- labels[i]</span></span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a><span class="co">#    attr(evals_pub[[col_name]], "label") &lt;- label</span></span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a><span class="co">#  }</span></span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a><span class="co"># expand categories into columns, unlist everything</span></span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a>evals_pub <span class="sc">%&lt;&gt;%</span></span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest_wider</span>(cat, <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span> <span class="co"># give each of these its own col</span></span>
<span id="cb8-195"><a href="#cb8-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), unlist))  <span class="co"># maybe check why some of these are lists in the first place</span></span>
<span id="cb8-196"><a href="#cb8-196" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-197"><a href="#cb8-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-198"><a href="#cb8-198" aria-hidden="true" tabindex="-1"></a><span class="co"># clean the Anonymous names</span></span>
<span id="cb8-199"><a href="#cb8-199" aria-hidden="true" tabindex="-1"></a>evals_pub<span class="sc">$</span>eval_name <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-200"><a href="#cb8-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">"^</span><span class="sc">\\</span><span class="st">b</span><span class="sc">\\</span><span class="st">w+</span><span class="sc">\\</span><span class="st">b$|</span><span class="sc">\\</span><span class="st">bAnonymous</span><span class="sc">\\</span><span class="st">b"</span>, evals_pub<span class="sc">$</span>eval_name),</span>
<span id="cb8-201"><a href="#cb8-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"Anonymous_"</span>, <span class="fu">seq_along</span>(evals_pub<span class="sc">$</span>eval_name)),</span>
<span id="cb8-202"><a href="#cb8-202" aria-hidden="true" tabindex="-1"></a>  evals_pub<span class="sc">$</span>eval_name</span>
<span id="cb8-203"><a href="#cb8-203" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-204"><a href="#cb8-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-205"><a href="#cb8-205" aria-hidden="true" tabindex="-1"></a><span class="co">#housekeeping</span></span>
<span id="cb8-206"><a href="#cb8-206" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(evals)</span>
<span id="cb8-207"><a href="#cb8-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-208"><a href="#cb8-208" aria-hidden="true" tabindex="-1"></a><span class="co">#Todo -- check the unlist is not propagating the entry</span></span>
<span id="cb8-209"><a href="#cb8-209" aria-hidden="true" tabindex="-1"></a><span class="co">#Note: category,  topic_subfield, and source have multiple meaningful categories. These will need care  </span></span>
<span id="cb8-210"><a href="#cb8-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-211"><a href="#cb8-211" aria-hidden="true" tabindex="-1"></a><span class="in">```</span>                   </span>
<span id="cb8-212"><a href="#cb8-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-213"><a href="#cb8-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-214"><a href="#cb8-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-215"><a href="#cb8-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-216"><a href="#cb8-216" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- need airtable API stuff --&gt;</span></span>
<span id="cb8-217"><a href="#cb8-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-218"><a href="#cb8-218" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reconcile uncertainty ratings and CIs {-}</span></span>
<span id="cb8-219"><a href="#cb8-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-220"><a href="#cb8-220" aria-hidden="true" tabindex="-1"></a>Where people gave only confidence level 'dots', we impute CIs (confidence/credible intervals). We follow the correspondence described <span class="co">[</span><span class="ot">here</span><span class="co">](https://effective-giving-marketing.gitbook.io/unjournal-x-ea-and-global-priorities-research/policies-projects-evaluation-workflow/evaluation/guidelines-for-evaluators#1-5-dots-explanation-and-relation-to-cis)</span>. (Otherwise, where they gave actual CIs, we use these.)^<span class="co">[</span><span class="ot">Note this is only a first-pass; a more sophisticated approach may be warranted in future.</span><span class="co">]</span></span>
<span id="cb8-221"><a href="#cb8-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-222"><a href="#cb8-222" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb8-223"><a href="#cb8-223" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dots to interval choices</span></span>
<span id="cb8-224"><a href="#cb8-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-225"><a href="#cb8-225" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; 5 = Extremely confident, i.e., 90% confidence interval spans +/- 4 points or less)</span></span>
<span id="cb8-226"><a href="#cb8-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-227"><a href="#cb8-227" aria-hidden="true" tabindex="-1"></a>For 0-100 ratings, code the LB as $max(R - 4,0)$ and the UB as $min(R + 4,100)$, where R is the stated (middle) rating. This 'scales' the CI, as interpreted, to be proportional to the rating, with a  maximum 'interval' of about 8, with the rating is about 96.</span>
<span id="cb8-228"><a href="#cb8-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-229"><a href="#cb8-229" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; 4 = Very*confident: 90% confidence interval +/- 8 points or less</span></span>
<span id="cb8-230"><a href="#cb8-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-231"><a href="#cb8-231" aria-hidden="true" tabindex="-1"></a>For 0-100 ratings, code the LB as $max(R - 8,0)$ and the UB as $min(R + 8,100)$, where R is the stated (middle) rating. </span>
<span id="cb8-232"><a href="#cb8-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-233"><a href="#cb8-233" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; 3 = Somewhat** confident: 90% confidence interval +/- 15 points or less</span><span class="dv">&amp;#x20;</span></span>
<span id="cb8-234"><a href="#cb8-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-235"><a href="#cb8-235" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; 2 = Not very** confident: 90% confidence interval, +/- 25 points or less</span></span>
<span id="cb8-236"><a href="#cb8-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-237"><a href="#cb8-237" aria-hidden="true" tabindex="-1"></a>Comparable scaling for the 2-3 ratings as for the 4 and 5 rating.</span>
<span id="cb8-238"><a href="#cb8-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-239"><a href="#cb8-239" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; 1 = Not** confident: (90% confidence interval +/- more than 25 points)</span></span>
<span id="cb8-240"><a href="#cb8-240" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-241"><a href="#cb8-241" aria-hidden="true" tabindex="-1"></a>Code LB as $max(R - 37.5,0)$ and the UB as $min(R + 37.5,100)$. </span>
<span id="cb8-242"><a href="#cb8-242" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-243"><a href="#cb8-243" aria-hidden="true" tabindex="-1"></a>This is just a first-pass. There might be a more information-theoretic way of doing this. On the other hand, we might be switching the evaluations to use a different tool soon, perhaps getting rid of the 1-5 confidence ratings altogether.</span>
<span id="cb8-244"><a href="#cb8-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-245"><a href="#cb8-245" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb8-246"><a href="#cb8-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-247"><a href="#cb8-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-248"><a href="#cb8-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r reconcile_bounds}</span></span>
<span id="cb8-249"><a href="#cb8-249" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: reconcile_bounds</span></span>
<span id="cb8-250"><a href="#cb8-250" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "reconcile explicit bounds and stated confidence level"</span></span>
<span id="cb8-251"><a href="#cb8-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-252"><a href="#cb8-252" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the baseline widths for each confidence rating</span></span>
<span id="cb8-253"><a href="#cb8-253" aria-hidden="true" tabindex="-1"></a><span class="co"># JB: it would be good to have some more backing of whether this</span></span>
<span id="cb8-254"><a href="#cb8-254" aria-hidden="true" tabindex="-1"></a><span class="co"># is a valid way to translate these confidence levels into CIs</span></span>
<span id="cb8-255"><a href="#cb8-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-256"><a href="#cb8-256" aria-hidden="true" tabindex="-1"></a><span class="co"># baseline_widths &lt;- c(4, 8, 15, 25, 37.5)</span></span>
<span id="cb8-257"><a href="#cb8-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-258"><a href="#cb8-258" aria-hidden="true" tabindex="-1"></a><span class="co"># Lists of categories</span></span>
<span id="cb8-259"><a href="#cb8-259" aria-hidden="true" tabindex="-1"></a>rating_cats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"overall"</span>, <span class="st">"adv_knowledge"</span>, <span class="st">"methods"</span>, <span class="st">"logic_comms"</span>, <span class="st">"real_world"</span>, <span class="st">"gp_relevance"</span>, <span class="st">"open_sci"</span>)</span>
<span id="cb8-260"><a href="#cb8-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-261"><a href="#cb8-261" aria-hidden="true" tabindex="-1"></a><span class="co">#... 'predictions' are currently 1-5 (0-5?)</span></span>
<span id="cb8-262"><a href="#cb8-262" aria-hidden="true" tabindex="-1"></a>pred_cats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"journal_predict"</span>, <span class="st">"merits_journal"</span>)</span>
<span id="cb8-263"><a href="#cb8-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-264"><a href="#cb8-264" aria-hidden="true" tabindex="-1"></a><span class="co">#DR: Note that I use these objects in future chapters, but they are not connected to the data frame. Either one saves and reinputs the whole environment (messy, replicability issue), or you save this somewhere and re-input it or connect it to the data frame that gets saved (not sure how to do it), or you hard-code reinput it in the next chapter. </span></span>
<span id="cb8-265"><a href="#cb8-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-266"><a href="#cb8-266" aria-hidden="true" tabindex="-1"></a><span class="co">#I do the latter for now, but I'm not happy about it, because the idea is 'input definitions in a single place to use later'</span></span>
<span id="cb8-267"><a href="#cb8-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-268"><a href="#cb8-268" aria-hidden="true" tabindex="-1"></a><span class="co">#JB: I don't really understand why not just hard code it in the next chapter. These are very short strings. Do you expect them to change often? If so, we can derive them from a dataframe somewhere in the future or save as a separate object. </span></span>
<span id="cb8-269"><a href="#cb8-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-270"><a href="#cb8-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-271"><a href="#cb8-271" aria-hidden="true" tabindex="-1"></a><span class="co"># JB: Rewritten functions for adding imputed ub and lb</span></span>
<span id="cb8-272"><a href="#cb8-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-273"><a href="#cb8-273" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the lower and upper bounds, </span></span>
<span id="cb8-274"><a href="#cb8-274" aria-hidden="true" tabindex="-1"></a><span class="co"># rating: given a rating, </span></span>
<span id="cb8-275"><a href="#cb8-275" aria-hidden="true" tabindex="-1"></a><span class="co"># conf: a confidence (1-5) score,</span></span>
<span id="cb8-276"><a href="#cb8-276" aria-hidden="true" tabindex="-1"></a><span class="co"># type: a bound type (lower, upper),</span></span>
<span id="cb8-277"><a href="#cb8-277" aria-hidden="true" tabindex="-1"></a><span class="co"># scale: a scale (100 is 0-100, 5 is 1-5)</span></span>
<span id="cb8-278"><a href="#cb8-278" aria-hidden="true" tabindex="-1"></a><span class="co"># This function is not vectorized</span></span>
<span id="cb8-279"><a href="#cb8-279" aria-hidden="true" tabindex="-1"></a>calc_bounds <span class="ot">&lt;-</span> <span class="cf">function</span>(rating, conf, type, scale) {</span>
<span id="cb8-280"><a href="#cb8-280" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-281"><a href="#cb8-281" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(scale <span class="sc">==</span> <span class="dv">5</span>){ <span class="co">#for the 'journal tier prediction case'</span></span>
<span id="cb8-282"><a href="#cb8-282" aria-hidden="true" tabindex="-1"></a>    baseline_width <span class="ot">=</span> <span class="fu">case_match</span>(conf, </span>
<span id="cb8-283"><a href="#cb8-283" aria-hidden="true" tabindex="-1"></a>                                <span class="dv">5</span> <span class="sc">~</span> .<span class="dv">2</span>, <span class="co">#4*5/100</span></span>
<span id="cb8-284"><a href="#cb8-284" aria-hidden="true" tabindex="-1"></a>                                <span class="dv">4</span> <span class="sc">~</span> .<span class="dv">4</span>, <span class="co">#8*5/100</span></span>
<span id="cb8-285"><a href="#cb8-285" aria-hidden="true" tabindex="-1"></a>                                <span class="dv">3</span> <span class="sc">~</span> .<span class="dv">75</span>, <span class="co">#15*5/100</span></span>
<span id="cb8-286"><a href="#cb8-286" aria-hidden="true" tabindex="-1"></a>                                <span class="dv">2</span> <span class="sc">~</span> <span class="fl">1.25</span>, <span class="co">#25*5/100</span></span>
<span id="cb8-287"><a href="#cb8-287" aria-hidden="true" tabindex="-1"></a>                                <span class="dv">1</span> <span class="sc">~</span> <span class="fl">1.875</span>, <span class="co">#37.5*5/100</span></span>
<span id="cb8-288"><a href="#cb8-288" aria-hidden="true" tabindex="-1"></a>                                <span class="at">.default =</span> <span class="cn">NA_real_</span>) </span>
<span id="cb8-289"><a href="#cb8-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-290"><a href="#cb8-290" aria-hidden="true" tabindex="-1"></a>    upper <span class="ot">=</span> <span class="fu">min</span>(rating <span class="sc">+</span> baseline_width, <span class="dv">5</span>)</span>
<span id="cb8-291"><a href="#cb8-291" aria-hidden="true" tabindex="-1"></a>    lower <span class="ot">=</span> <span class="fu">max</span>(rating <span class="sc">-</span> baseline_width, <span class="dv">1</span>)</span>
<span id="cb8-292"><a href="#cb8-292" aria-hidden="true" tabindex="-1"></a>  }<span class="co">#/if(scale == 5)</span></span>
<span id="cb8-293"><a href="#cb8-293" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-294"><a href="#cb8-294" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(scale <span class="sc">==</span> <span class="dv">100</span>){ <span class="co">#for the 'ratings case'</span></span>
<span id="cb8-295"><a href="#cb8-295" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-296"><a href="#cb8-296" aria-hidden="true" tabindex="-1"></a>    baseline_width <span class="ot">=</span> <span class="fu">case_match</span>(conf, </span>
<span id="cb8-297"><a href="#cb8-297" aria-hidden="true" tabindex="-1"></a>                                <span class="dv">5</span> <span class="sc">~</span> <span class="dv">4</span>, </span>
<span id="cb8-298"><a href="#cb8-298" aria-hidden="true" tabindex="-1"></a>                                <span class="dv">4</span> <span class="sc">~</span> <span class="dv">8</span>, </span>
<span id="cb8-299"><a href="#cb8-299" aria-hidden="true" tabindex="-1"></a>                                <span class="dv">3</span> <span class="sc">~</span> <span class="dv">15</span>, </span>
<span id="cb8-300"><a href="#cb8-300" aria-hidden="true" tabindex="-1"></a>                                <span class="dv">2</span> <span class="sc">~</span> <span class="dv">25</span>, </span>
<span id="cb8-301"><a href="#cb8-301" aria-hidden="true" tabindex="-1"></a>                                <span class="dv">1</span> <span class="sc">~</span> <span class="fl">37.5</span>,</span>
<span id="cb8-302"><a href="#cb8-302" aria-hidden="true" tabindex="-1"></a>                                <span class="at">.default =</span> <span class="cn">NA_real_</span>)</span>
<span id="cb8-303"><a href="#cb8-303" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-304"><a href="#cb8-304" aria-hidden="true" tabindex="-1"></a>    upper <span class="ot">=</span> <span class="fu">min</span>(rating <span class="sc">+</span> baseline_width, <span class="dv">100</span>)</span>
<span id="cb8-305"><a href="#cb8-305" aria-hidden="true" tabindex="-1"></a>    lower <span class="ot">=</span> <span class="fu">max</span>(rating <span class="sc">-</span> baseline_width, <span class="dv">0</span>)</span>
<span id="cb8-306"><a href="#cb8-306" aria-hidden="true" tabindex="-1"></a>  } <span class="co">#/if(scale == 100)</span></span>
<span id="cb8-307"><a href="#cb8-307" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-308"><a href="#cb8-308" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">"lower"</span>) <span class="fu">return</span>(lower)</span>
<span id="cb8-309"><a href="#cb8-309" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(type <span class="sc">==</span> <span class="st">"upper"</span>) <span class="fu">return</span>(upper)</span>
<span id="cb8-310"><a href="#cb8-310" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-311"><a href="#cb8-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-312"><a href="#cb8-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-313"><a href="#cb8-313" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate or find correct lower or upper bound</span></span>
<span id="cb8-314"><a href="#cb8-314" aria-hidden="true" tabindex="-1"></a><span class="co"># based on rating type, and lb, ub, and conf values</span></span>
<span id="cb8-315"><a href="#cb8-315" aria-hidden="true" tabindex="-1"></a>impute_bounds <span class="ot">&lt;-</span> <span class="cf">function</span>(var_name, est, lb, ub, conf, bound_type) {</span>
<span id="cb8-316"><a href="#cb8-316" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-317"><a href="#cb8-317" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get scale of each variable</span></span>
<span id="cb8-318"><a href="#cb8-318" aria-hidden="true" tabindex="-1"></a>  scale <span class="ot">=</span> <span class="fu">if_else</span>(var_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"journal_predict"</span>, <span class="st">"merits_journal"</span>), <span class="co"># if variable is a prediction</span></span>
<span id="cb8-319"><a href="#cb8-319" aria-hidden="true" tabindex="-1"></a>                  <span class="dv">5</span>, <span class="dv">100</span>) <span class="co">#scale is 5, else scale is 100</span></span>
<span id="cb8-320"><a href="#cb8-320" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if calculating lower bound variable</span></span>
<span id="cb8-321"><a href="#cb8-321" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(bound_type <span class="sc">==</span> <span class="st">"lower"</span>) { <span class="co">#we are calculating a lower bound imputation</span></span>
<span id="cb8-322"><a href="#cb8-322" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span></span>
<span id="cb8-323"><a href="#cb8-323" aria-hidden="true" tabindex="-1"></a>    calculated_bound <span class="ot">=</span> <span class="fu">map_dbl</span>(<span class="at">.x =</span> est, <span class="at">.f =</span> calc_bounds, <span class="at">conf =</span> conf, <span class="at">type =</span> bound_type, <span class="at">scale =</span> scale)</span>
<span id="cb8-324"><a href="#cb8-324" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-325"><a href="#cb8-325" aria-hidden="true" tabindex="-1"></a>    imp_bound <span class="ot">=</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(lb), calculated_bound, lb)</span>
<span id="cb8-326"><a href="#cb8-326" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-327"><a href="#cb8-327" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-328"><a href="#cb8-328" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if calculating upper bound variable</span></span>
<span id="cb8-329"><a href="#cb8-329" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(bound_type <span class="sc">==</span> <span class="st">"upper"</span>) { <span class="co">#we are calculating an upper bound imputation</span></span>
<span id="cb8-330"><a href="#cb8-330" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span></span>
<span id="cb8-331"><a href="#cb8-331" aria-hidden="true" tabindex="-1"></a>    calculated_bound <span class="ot">=</span> <span class="fu">map_dbl</span>(<span class="at">.x =</span> est, <span class="at">.f =</span> calc_bounds, <span class="at">conf =</span> conf, <span class="at">type =</span> bound_type, <span class="at">scale =</span> scale)</span>
<span id="cb8-332"><a href="#cb8-332" aria-hidden="true" tabindex="-1"></a>    imp_bound <span class="ot">=</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(ub), calculated_bound, ub)</span>
<span id="cb8-333"><a href="#cb8-333" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-334"><a href="#cb8-334" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-335"><a href="#cb8-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(imp_bound)</span>
<span id="cb8-336"><a href="#cb8-336" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-337"><a href="#cb8-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-338"><a href="#cb8-338" aria-hidden="true" tabindex="-1"></a><span class="co"># apply functions to evals_pub</span></span>
<span id="cb8-339"><a href="#cb8-339" aria-hidden="true" tabindex="-1"></a><span class="co"># JB: I had to do a lot of gymnastics to make this data frame</span></span>
<span id="cb8-340"><a href="#cb8-340" aria-hidden="true" tabindex="-1"></a><span class="co"># right for applying the functions, then turn it back into</span></span>
<span id="cb8-341"><a href="#cb8-341" aria-hidden="true" tabindex="-1"></a><span class="co"># the data structure we are currently using I didn't want to deal</span></span>
<span id="cb8-342"><a href="#cb8-342" aria-hidden="true" tabindex="-1"></a><span class="co"># with how changing the data input would break the rest of the</span></span>
<span id="cb8-343"><a href="#cb8-343" aria-hidden="true" tabindex="-1"></a><span class="co"># code But we should prioritize saving this data frame in a long format</span></span>
<span id="cb8-344"><a href="#cb8-344" aria-hidden="true" tabindex="-1"></a><span class="co"># so there isn't data in the variable names (i.e., each row should at least </span></span>
<span id="cb8-345"><a href="#cb8-345" aria-hidden="true" tabindex="-1"></a><span class="co"># be one type of rating, not one article). </span></span>
<span id="cb8-346"><a href="#cb8-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-347"><a href="#cb8-347" aria-hidden="true" tabindex="-1"></a>evals_pub <span class="sc">%&gt;%</span> </span>
<span id="cb8-348"><a href="#cb8-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(id, crucial_rsx, paper_abbrev, eval_name, </span>
<span id="cb8-349"><a href="#cb8-349" aria-hidden="true" tabindex="-1"></a>                         cat_1,cat_2, cat_3,source_main,author_agreement),</span>
<span id="cb8-350"><a href="#cb8-350" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_pattern =</span> <span class="st">"(lb_|ub_|conf_)?(.+)"</span>,</span>
<span id="cb8-351"><a href="#cb8-351" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"value_type"</span>, <span class="st">"rating_type"</span>)) <span class="sc">%&gt;%</span> <span class="co"># one line per rating type</span></span>
<span id="cb8-352"><a href="#cb8-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value_type =</span> <span class="fu">if_else</span>(value_type <span class="sc">==</span> <span class="st">""</span>, <span class="st">"est_"</span>, value_type)) <span class="sc">%&gt;%</span> <span class="co">#add main rating id</span></span>
<span id="cb8-353"><a href="#cb8-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> value_type, </span>
<span id="cb8-354"><a href="#cb8-354" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb8-355"><a href="#cb8-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> <span class="co"># apply function to each row</span></span>
<span id="cb8-356"><a href="#cb8-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lb_imp_ =</span> <span class="fu">impute_bounds</span>(<span class="at">var_name =</span> rating_type,</span>
<span id="cb8-357"><a href="#cb8-357" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">est =</span> est_,</span>
<span id="cb8-358"><a href="#cb8-358" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">lb =</span> lb_, <span class="at">ub =</span> ub_, <span class="at">conf =</span> conf_,</span>
<span id="cb8-359"><a href="#cb8-359" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">bound_type =</span> <span class="st">"lower"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-360"><a href="#cb8-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ub_imp_ =</span> <span class="fu">impute_bounds</span>(<span class="at">var_name =</span> rating_type,</span>
<span id="cb8-361"><a href="#cb8-361" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">est =</span> est_,</span>
<span id="cb8-362"><a href="#cb8-362" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">lb =</span> lb_, <span class="at">ub =</span> ub_, <span class="at">conf =</span> conf_,</span>
<span id="cb8-363"><a href="#cb8-363" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">bound_type =</span> <span class="st">"upper"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-364"><a href="#cb8-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> rating_type, <span class="co"># take the dataframe back to old format</span></span>
<span id="cb8-365"><a href="#cb8-365" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="fu">c</span>(est_, ub_, lb_, conf_, lb_imp_, ub_imp_),</span>
<span id="cb8-366"><a href="#cb8-366" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_sep =</span> <span class="st">""</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-367"><a href="#cb8-367" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(<span class="at">.cols =</span> <span class="fu">matches</span>(<span class="st">"^[ul]b_imp"</span>),</span>
<span id="cb8-368"><a href="#cb8-368" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.fn =</span> gsub,</span>
<span id="cb8-369"><a href="#cb8-369" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pattern =</span> <span class="st">"(ub_imp|lb_imp)_(.+)"</span>, </span>
<span id="cb8-370"><a href="#cb8-370" aria-hidden="true" tabindex="-1"></a>                     <span class="at">replacement =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">2_</span><span class="sc">\\</span><span class="st">1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-371"><a href="#cb8-371" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">"est_"</span>),</span>
<span id="cb8-372"><a href="#cb8-372" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.fn =</span> gsub,</span>
<span id="cb8-373"><a href="#cb8-373" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pattern =</span> <span class="st">"est_(.+)"</span>,</span>
<span id="cb8-374"><a href="#cb8-374" aria-hidden="true" tabindex="-1"></a>                     <span class="at">replacement =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>) <span class="ot">-&gt;</span> evals_pub</span>
<span id="cb8-375"><a href="#cb8-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-376"><a href="#cb8-376" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-377"><a href="#cb8-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-378"><a href="#cb8-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-379"><a href="#cb8-379" aria-hidden="true" tabindex="-1"></a>We cannot publicly share the 'papers under consideration', but we can share some of the statistics on these papers. Let's generate an ID (or later, salted hash) for each such paper, and keep only the shareable features of interest</span>
<span id="cb8-380"><a href="#cb8-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-383"><a href="#cb8-383" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb8-384"><a href="#cb8-384" aria-hidden="true" tabindex="-1"></a>all_papers_p <span class="ot">&lt;-</span> all_pub_records <span class="sc">%&gt;%</span> </span>
<span id="cb8-385"><a href="#cb8-385" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb8-386"><a href="#cb8-386" aria-hidden="true" tabindex="-1"></a>    id,</span>
<span id="cb8-387"><a href="#cb8-387" aria-hidden="true" tabindex="-1"></a>    category,</span>
<span id="cb8-388"><a href="#cb8-388" aria-hidden="true" tabindex="-1"></a>    cfdc_DR,</span>
<span id="cb8-389"><a href="#cb8-389" aria-hidden="true" tabindex="-1"></a>     <span class="st">'confidence -- user entered'</span>,</span>
<span id="cb8-390"><a href="#cb8-390" aria-hidden="true" tabindex="-1"></a>    cfdc_assessor,</span>
<span id="cb8-391"><a href="#cb8-391" aria-hidden="true" tabindex="-1"></a>    avg_cfdc,</span>
<span id="cb8-392"><a href="#cb8-392" aria-hidden="true" tabindex="-1"></a>    category,</span>
<span id="cb8-393"><a href="#cb8-393" aria-hidden="true" tabindex="-1"></a>    cause_cat_1_text,</span>
<span id="cb8-394"><a href="#cb8-394" aria-hidden="true" tabindex="-1"></a>    cause_cat_2_text,</span>
<span id="cb8-395"><a href="#cb8-395" aria-hidden="true" tabindex="-1"></a>    topic_subfield_text,</span>
<span id="cb8-396"><a href="#cb8-396" aria-hidden="true" tabindex="-1"></a>    eval_manager_text,</span>
<span id="cb8-397"><a href="#cb8-397" aria-hidden="true" tabindex="-1"></a>    <span class="st">'publication status'</span>,</span>
<span id="cb8-398"><a href="#cb8-398" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Contacted author?'</span>,</span>
<span id="cb8-399"><a href="#cb8-399" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stage of process/todo'</span>,</span>
<span id="cb8-400"><a href="#cb8-400" aria-hidden="true" tabindex="-1"></a>    <span class="st">'source_main'</span>,  </span>
<span id="cb8-401"><a href="#cb8-401" aria-hidden="true" tabindex="-1"></a>    <span class="st">'author permission?'</span>,</span>
<span id="cb8-402"><a href="#cb8-402" aria-hidden="true" tabindex="-1"></a><span class="st">'Direct Kotahi Prize Submission?'</span>,</span>
<span id="cb8-403"><a href="#cb8-403" aria-hidden="true" tabindex="-1"></a>    <span class="st">'createdTime'</span>         </span>
<span id="cb8-404"><a href="#cb8-404" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-405"><a href="#cb8-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-406"><a href="#cb8-406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-407"><a href="#cb8-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-408"><a href="#cb8-408" aria-hidden="true" tabindex="-1"></a><span class="in">```{r shiny_data_explorer}</span></span>
<span id="cb8-409"><a href="#cb8-409" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataset to be used as the input to a shiny app</span></span>
<span id="cb8-410"><a href="#cb8-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-411"><a href="#cb8-411" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb8-412"><a href="#cb8-412" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb8-413"><a href="#cb8-413" aria-hidden="true" tabindex="-1"></a>paper_ratings <span class="ot">&lt;-</span> evals_pub <span class="sc">%&gt;%</span> </span>
<span id="cb8-414"><a href="#cb8-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(paper_abbrev, eval_name, <span class="fu">one_of</span>(rating_cats), <span class="fu">one_of</span>(pred_cats), <span class="fu">ends_with</span>(<span class="st">"_imp"</span>)) <span class="sc">%&gt;%</span> <span class="co"># rating vars</span></span>
<span id="cb8-415"><a href="#cb8-415" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(<span class="at">.cols =</span> <span class="fu">c</span>(<span class="fu">one_of</span>(rating_cats), <span class="fu">one_of</span>(pred_cats)),</span>
<span id="cb8-416"><a href="#cb8-416" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.fn =</span> gsub,</span>
<span id="cb8-417"><a href="#cb8-417" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pattern =</span> <span class="st">"(.+)"</span>, </span>
<span id="cb8-418"><a href="#cb8-418" aria-hidden="true" tabindex="-1"></a>                     <span class="at">replacement =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">1_best"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-419"><a href="#cb8-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(paper_abbrev, eval_name),</span>
<span id="cb8-420"><a href="#cb8-420" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_pattern =</span> <span class="st">"(overall|adv_knowledge|methods|logic_comms|real_world|gp_relevance|open_sci|journal_predict|merits_journal)_(.+)"</span>,</span>
<span id="cb8-421"><a href="#cb8-421" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"rating_type"</span>, <span class="st">".value"</span>))<span class="co"># one line per rating type</span></span>
<span id="cb8-422"><a href="#cb8-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-423"><a href="#cb8-423" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(paper_ratings, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">"shinyapp/DataExplorer"</span>, <span class="st">"shiny_explorer.rds"</span>))</span>
<span id="cb8-424"><a href="#cb8-424" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb8-425"><a href="#cb8-425" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-426"><a href="#cb8-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-427"><a href="#cb8-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-430"><a href="#cb8-430" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb8-431"><a href="#cb8-431" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: savedata</span></span>
<span id="cb8-432"><a href="#cb8-432" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "save data for others' use"</span></span>
<span id="cb8-433"><a href="#cb8-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-434"><a href="#cb8-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-435"><a href="#cb8-435" aria-hidden="true" tabindex="-1"></a>all_papers_p <span class="sc">%&gt;%</span> <span class="fu">saveRDS</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"all_papers_p.Rdata"</span>))</span>
<span id="cb8-436"><a href="#cb8-436" aria-hidden="true" tabindex="-1"></a>all_papers_p <span class="sc">%&gt;%</span> <span class="fu">write_csv</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"all_papers_p.csv"</span>))</span>
<span id="cb8-437"><a href="#cb8-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-438"><a href="#cb8-438" aria-hidden="true" tabindex="-1"></a>evals_pub <span class="sc">%&gt;%</span> <span class="fu">saveRDS</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"evals.Rdata"</span>))</span>
<span id="cb8-439"><a href="#cb8-439" aria-hidden="true" tabindex="-1"></a>evals_pub <span class="sc">%&gt;%</span> <span class="fu">write_csv</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"evals.csv"</span>))</span>
<span id="cb8-440"><a href="#cb8-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-441"><a href="#cb8-441" aria-hidden="true" tabindex="-1"></a><span class="co">#evals_pub %&gt;% readRDS(file = here("data", "evals.Rdata"))</span></span>
<span id="cb8-442"><a href="#cb8-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-443"><a href="#cb8-443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>